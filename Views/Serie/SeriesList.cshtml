@model IEnumerable<BootFlixBC9.Models.Serie>
@{
    ViewBag.Title = "Index";
}

<h2>Series</h2>
<p>@Html.ActionLink("New Serie", "New", "Serie", null, new { @class = "btn btn-primary" }) </p>
<table id="series" class="table table-bordered">
    <thead>
        <tr>
            <th>Name</th>
            <th>Seasons</th>
            <th>Date Added</th>
            <th>Date Released</th>
            <th>Delete</th>
            <th>Genre</th>
            <th>IsReleased</th>
        </tr>
    </thead>

    <tbody>
        @*

                    @foreach(var serie in Model)
                    {
                        <tr>
                            <td>@serie.Name</td>
            <td>@Html.ActionLink(serie.Name, "Edit", "Serie", new { id = serie.Id }, null)</td>
            <td>@serie.Seasons</td>
            <td>@serie.Genre.Name</td>
            <td>@serie.DateAdded</td>
            <td>@serie.DateReleased</td>
            <td>
                <button data-viewer-id="@serie.Id" class="btn btn-link js-delete">Delete</button>
            </td>
            </tr>
            }*@
    </tbody>
</table>

@section scripts{
    <script>
    $(document).ready(function () {
        var table = $("#series").DataTable({
            ajax: {
                url: "/api/series/",
                dataSrc: ""
            },
            columns: [
                {
                    data: "name",
                    render: function (data, type, serie) {
                        return "<a href='/serie/edit/" + serie.id + "'>" + serie.name + "</a>";
                    }
                },
                {
                    data: "seasons"
                },
                {
                    data: "dateAdded"
                },
                {
                    data: "dateReleased"
                },
                {
                    data: "id",
                    render: function (data) {
                        return "<button class='btn btn-link js-delete' data-viewer-id=" + data + ">Delete</button>"
                    }
                },
                {
                    data: "genre.name"
                },
                {
                    data: "isReleased"
                }
            ]
        });
        $("#series").on("click", ".js-delete", function () {
            let button = $(this);
            bootbox.confirm("Delete?Are you SuRe?", function (result) {
                            if (result) {
                $.ajax({
                    url: "/api/series/" + button.attr("data-viewer-id"),
                    method: "DELETE",
                    success: function () {
                        table.row(button.parents("tr")).remove().draw();
                    }
                })
            }
            })

        });

    }); @*document ready closing tag*@

    </script>
} @*end  of section scripts*@